<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <link rel='stylesheet' type='text/css' href='cssTimetable.css'>
        <title>View Current Requests</title>
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript">
        //onload 
        $(document).ready(function(){wrRequestsTable();});
        
        function wrRequestsTable(){
            //writes and populates Requests table. needs preferences input
            $.ajax({
                type: "GET",
                dataType: "json",
                url: "GETallRequests.php",
                success: function(JSON){
                    
                    var codeStr = "";
                    codeStr += '<table id="RequestsTable">';
                    codeStr += '<tr>';
                    codeStr += '    <th>Module Code</th>';
                    codeStr += '    <th>Priority</th>';
                    codeStr += '    <th>Day</th>';
                    codeStr += '    <th>Period</th>';
                    codeStr += '    <th>Details</th>';
                    codeStr += '    <th>Status</th>';
                    codeStr += '</tr>';
                    
                    for(var i=0;i<JSON.length;i++){
                        codeStr += '<tr>';
                        codeStr += '    <td>' + JSON[i].moduleid + '</td>';
                        codeStr += '    <td>' + JSON[i].priority + '</td>';
                        codeStr += '    <td>' + JSON[i].day + '</td>';
                        codeStr += '    <td>' + JSON[i].period + '</td>';
                        codeStr += '    <td><input type="button" class="detailsButton" value="Details" onclick="showDetails(' + JSON[i].requestid + ')"></input></td>';
                        codeStr += '    <td>' + JSON[i].requeststatus + '</td>';
                        codeStr += '</tr>';
                    }
                    codeStr += "</table">
                    
                    //clears and writes table into container
                    // UPDATE: empty function produced 'false' onscreen when already empty
                    //$("#tableBox").empty();
                    $("#tableBox").append(codeStr);
                }
            });
        }
        
        function showDetails(requestID){
            
            $.get("GETdetailedRequests.php", {id: requestID}, function(JSON){
                alert("test!!\n requestsID: " + JSON[0].requestid + "\n" + "Duration: " + JSON[0].duration + "\n" + "NO. Students: " + JSON[0].noofstudents + "\n etc....");
            }, 'json');
				
        
        }
        </script>
    </head>
     
    <body>
        <div id="navwrap">
             <ul id="topnav">
                <li><a href="viewRequests.htm"><img src="LU-mark-rgb.png" alt="Home"></a></li>
                <li><a href="addRequests.htm">Add New Requests</a></li>
                <li><a href="viewTimetable.htm">View Timetable</a></li>
                <li><a href="helpPage.htm">Help</a></li>
                <li><a href="accountPage.htm">Username(pref)</a></li>
            </ul>
        </div>
        <div id="pagewrap">
            <div class="contentBox" id="actionsBox"></div>
            
            <div class="contentBox" id="searchBox"></div>

            <div class="contentBox" id="roundsBox"></div>

            
            <div class="contentBox" id="tableBox"></div>
            
        </div>
    </body>
</html>